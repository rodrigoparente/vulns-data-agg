# python imports
import time
import re

# project imports
from commons.parse import request_clean_page


def extract_date(exploit_id):
    exploit_date = ''

    http_error_wait = 5

    error_limit = 0
    max_error_limit = 5

    while True:
        try:
            resp = request_clean_page(f'https://www.exploit-db.com/exploits/{exploit_id}')
            exploit_date = resp.find('h6', string=re.compile(r'\d{4}-\d{2}-\d{2}'))
            exploit_date = exploit_date.text.strip().rstrip()
        except Exception:
            time.sleep(http_error_wait)
            http_error_wait *= 2

            if error_limit > max_error_limit:
                break

            error_limit += 1
            continue
        finally:
            break

    return exploit_date
